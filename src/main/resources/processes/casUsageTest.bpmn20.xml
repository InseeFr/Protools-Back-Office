<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://flowable.org/bpmn20" exporter="Flowable Open Source Modeler" exporterVersion="6.7.2">
    <process id="EnqueteTest" name="Enquête Test" isExecutable="true">
        <documentation>Enquête de test - prototype stage Protools</documentation>
        <serviceTask id="CheckSurveyInfo" name="Check New Survey" flowable:delegateExpression="${sampleServiceTask}">
            <documentation>Vérifie la taille de l'échantillon, un échantillon est désigné comme valide s'il contient plus de 5 unités d'enquête</documentation>
        </serviceTask>
        <subProcess id="Activity_0xukvyb" name="Draw Sample &amp; Add to survey" flowable:async="true" flowable:exclusive="false">
            <multiInstanceLoopCharacteristics isSequential="false" flowable:collection="sample" flowable:elementVariable="unit">
                <extensionElements></extensionElements>
            </multiInstanceLoopCharacteristics>
            <startEvent id="Event_0g6ye5t" name="BeginSub"  flowable:async="true" flowable:exclusive="false" flowable:formFieldValidation="true">
                <documentation>Début du sous processus pour une UE</documentation>
            </startEvent>
            <serviceTask id="selectUnitTask" name="Select Unit" flowable:async="true" flowable:exclusive="false" flowable:delegateExpression="${sampleServiceTask}">
                <documentation>Tire une unité d'enquête dans une base de donnée d'unités</documentation>
            </serviceTask>
            <serviceTask id="createAccountTask" name="Create Account" flowable:async="true" flowable:exclusive="false" flowable:delegateExpression="${sampleServiceTask}">
                <documentation>Création de compte pour une unité d'enquête avec son adresse email</documentation>
            </serviceTask>
            <serviceTask id="AddToSurveyTask" name="Add to survey" flowable:async="true" flowable:exclusive="false" flowable:delegateExpression="${sampleServiceTask}">
                <documentation>Ajout de l'unité sélectionnée à l'enquête</documentation>
            </serviceTask>
            <endEvent id="Event_0usmaxh" flowable:async="true" flowable:exclusive="false">
                <documentation>Fin du sous processus pour une UE</documentation>
            </endEvent>
            <inclusiveGateway id="GW2" name="GW2" flowable:async="true" flowable:exclusive="false"></inclusiveGateway>
            <inclusiveGateway id="GW3" name="GW3" flowable:async="true" flowable:exclusive="false"></inclusiveGateway>
            <sequenceFlow id="Flow_0t98vlv" sourceRef="Event_0g6ye5t" targetRef="selectUnitTask"></sequenceFlow>
            <sequenceFlow id="Flow_0x3s1eq" sourceRef="selectUnitTask" targetRef="GW2"></sequenceFlow>
            <sequenceFlow id="Flow_17baz8z" sourceRef="GW2" targetRef="createAccountTask"></sequenceFlow>
            <sequenceFlow id="Flow_0fi4bip" sourceRef="AddToSurveyTask" targetRef="GW3"></sequenceFlow>
            <sequenceFlow id="Flow_0vkdg8s" sourceRef="GW3" targetRef="Event_0usmaxh"></sequenceFlow>
            <sequenceFlow id="Flow_130f8tf" sourceRef="createAccountTask" targetRef="GW3"></sequenceFlow>
            <sequenceFlow id="Flow_0v75gto" sourceRef="GW2" targetRef="AddToSurveyTask"></sequenceFlow>
        </subProcess>
        <serviceTask id="surverSetStateReady" name="Survey setStateReady" flowable:delegateExpression="${sampleServiceTask}">
            <documentation>Déclare l'enquête prête</documentation>
        </serviceTask>
        <endEvent id="Event_1pfixvm" name="End"></endEvent>
        <sequenceFlow id="Flow_13828zo" sourceRef="surverSetStateReady" targetRef="Event_1pfixvm"></sequenceFlow>
        <serviceTask id="saveSurveyInfoTask" name="SaveSurveyInfo" flowable:async="true" flowable:exclusive="false"  flowable:delegateExpression="${sampleServiceTask}">
            <documentation>Sauvegarde les premières variables d'enquête</documentation>
        </serviceTask>
        <startEvent id="StartEvent_1" name="Begin" flowable:formFieldValidation="true"></startEvent>
        <exclusiveGateway id="GW1" name="GW1"></exclusiveGateway>
        <sequenceFlow id="Flow_11zmguh" sourceRef="CheckSurveyInfo" targetRef="GW1"></sequenceFlow>
        <serviceTask id="Activity_14b1tdt" name="Abort Process Sample Size" flowable:delegateExpression="${sampleServiceTask}">
            <documentation>Annule l'execution du processus en cas d'erreur</documentation>
        </serviceTask>
        <endEvent id="Event_1rfbgqc" name="End Error"></endEvent>
        <sequenceFlow id="Flow_04vgcgq" sourceRef="Activity_14b1tdt" targetRef="Event_1rfbgqc"></sequenceFlow>
        <sequenceFlow id="Flow_0j9p0t5" sourceRef="saveSurveyInfoTask" targetRef="Event_timer_1"></sequenceFlow>
        <intermediateCatchEvent id="Event_timer_1" name="10s wait">
            <timerEventDefinition>
                <timeDuration>PT10S</timeDuration>
            </timerEventDefinition>
        </intermediateCatchEvent>
        <sequenceFlow id="Flow_0mp29qt" sourceRef="StartEvent_1" targetRef="firstUserTask"></sequenceFlow>
        <userTask id="firstUserTask" name="Fill survey info" flowable:assignee="user" flowable:formFieldValidation="true">
            <documentation>Demande à l'utilisateur le nom de l'enquête, la taille de l'échantillon, la date de début et de fin</documentation>
            <extensionElements>
                <modeler:initiator-can-complete xmlns:modeler="http://flowable.org/modeler"><![CDATA[false]]></modeler:initiator-can-complete>
            </extensionElements>
        </userTask>
        <userTask id="secondUserTask" name="secondUserTask" flowable:assignee="user" flowable:formFieldValidation="true">
            <documentation>secondUserTask</documentation>
            <extensionElements>
                <modeler:initiator-can-complete xmlns:modeler="http://flowable.org/modeler"><![CDATA[false]]></modeler:initiator-can-complete>
            </extensionElements>
        </userTask>


        <userTask id="CheckFinalState" name="Check Final State" flowable:assignee="user" flowable:formFieldValidation="true">
            <documentation>Visualisation de l'état final du processus avant validation</documentation>
            <extensionElements>
                <modeler:initiator-can-complete xmlns:modeler="http://flowable.org/modeler"><![CDATA[false]]></modeler:initiator-can-complete>
            </extensionElements>
        </userTask>
        <sequenceFlow id="sid-B59A5914-F7DB-4A2C-B74A-C03D9E01B86A" sourceRef="CheckFinalState" targetRef="surverSetStateReady"></sequenceFlow>
        <sequenceFlow id="Flow_2" sourceRef="firstUserTask" targetRef="secondUserTask"></sequenceFlow>

        <sequenceFlow id="Flow_1hv6ani" sourceRef="secondUserTask" targetRef="CheckSurveyInfo"></sequenceFlow>
        <sequenceFlow id="sid-58FAF948-EC3F-4DE9-8C9C-5CAD2F6426A3" sourceRef="Event_timer_1" targetRef="Activity_0xukvyb"></sequenceFlow>
        <sequenceFlow id="flow-subprocess-checkFinalState" sourceRef="Activity_0xukvyb" targetRef="CheckFinalState"></sequenceFlow>
        <sequenceFlow id="Flow_030lv4j" sourceRef="GW1" targetRef="saveSurveyInfoTask">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${surveyValid == true}]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="sid-3C9C7EA0-4129-4176-BB90-004CDCA55E6C" sourceRef="GW1" targetRef="Activity_14b1tdt">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${surveyValid == false}]]></conditionExpression>
        </sequenceFlow>
    </process>
    <bpmndi:BPMNDiagram id="BPMNDiagram_EnqueteTest">
        <bpmndi:BPMNPlane bpmnElement="EnqueteTest" id="BPMNPlane_EnqueteTest">
            <bpmndi:BPMNShape bpmnElement="CheckSurveyInfo" id="BPMNShape_CheckSurveyInfo">
                <omgdc:Bounds height="80.0" width="100.0" x="285.0" y="147.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Activity_0xukvyb" id="BPMNShape_Activity_0xukvyb">
                <omgdc:Bounds height="302.0" width="566.0" x="810.0" y="90.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Event_0g6ye5t" id="BPMNShape_Event_0g6ye5t">
                <omgdc:Bounds height="30.0" width="30.0" x="840.0" y="175.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="selectUnitTask" id="BPMNShape_selectUnitTask">
                <omgdc:Bounds height="80.0" width="100.0" x="900.0" y="150.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="createAccountTask" id="BPMNShape_createAccountTask">
                <omgdc:Bounds height="80.0" width="100.0" x="1110.0" y="150.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="AddToSurveyTask" id="BPMNShape_AddToSurveyTask">
                <omgdc:Bounds height="80.0" width="100.0" x="1110.0" y="255.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Event_0usmaxh" id="BPMNShape_Event_0usmaxh">
                <omgdc:Bounds height="28.0" width="28.0" x="1320.0" y="176.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="GW2" id="BPMNShape_GW2">
                <omgdc:Bounds height="40.0" width="40.0" x="1035.0" y="165.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="GW3" id="BPMNShape_GW3">
                <omgdc:Bounds height="40.0" width="40.0" x="1245.0" y="170.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="surverSetStateReady" id="BPMNShape_surverSetStateReady">
                <omgdc:Bounds height="80.0" width="100.0" x="1560.0" y="330.5"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Event_1pfixvm" id="BPMNShape_Event_1pfixvm">
                <omgdc:Bounds height="28.0" width="28.0" x="1696.5" y="356.5"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="saveSurveyInfoTask" id="BPMNShape_saveSurveyInfoTask">
                <omgdc:Bounds height="80.0" width="100.0" x="540.0" y="147.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="StartEvent_1" id="BPMNShape_StartEvent_1">
                <omgdc:Bounds height="30.0" width="30.0" x="195.0" y="328.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="GW1" id="BPMNShape_GW1">
                <omgdc:Bounds height="40.0" width="40.0" x="445.0" y="167.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Activity_14b1tdt" id="BPMNShape_Activity_14b1tdt">
                <omgdc:Bounds height="80.0" width="100.0" x="415.0" y="300.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Event_1rfbgqc" id="BPMNShape_Event_1rfbgqc">
                <omgdc:Bounds height="28.0" width="28.0" x="576.0" y="326.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="Event_timer_1" id="BPMNShape_Event_timer_1">
                <omgdc:Bounds height="31.0" width="31.0" x="705.0" y="171.5"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="firstUserTask" id="BPMNShape_firstUserTask">
                <omgdc:Bounds height="80.0" width="100.0" x="285.0" y="303.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="CheckFinalState" id="BPMNShape_CheckFinalState">
                <omgdc:Bounds height="80.0" width="100.0" x="1560.0" y="195.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNEdge bpmnElement="Flow_0v75gto" id="BPMNEdge_Flow_0v75gto" flowable:sourceDockerX="20.0" flowable:sourceDockerY="20.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="1055.0" y="204.94032492725512"></omgdi:waypoint>
                <omgdi:waypoint x="1055.0" y="288.0"></omgdi:waypoint>
                <omgdi:waypoint x="1109.9999999999995" y="291.66666666666663"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_17baz8z" id="BPMNEdge_Flow_17baz8z" flowable:sourceDockerX="20.0" flowable:sourceDockerY="20.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="1074.034945504087" y="185.9068181818182"></omgdi:waypoint>
                <omgdi:waypoint x="1110.0" y="187.61904761904762"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0j9p0t5" id="BPMNEdge_Flow_0j9p0t5" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="15.5" flowable:targetDockerY="15.5">
                <omgdi:waypoint x="639.949999999981" y="187.0"></omgdi:waypoint>
                <omgdi:waypoint x="705.0" y="187.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_11zmguh" id="BPMNEdge_Flow_11zmguh" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="20.0" flowable:targetDockerY="20.0">
                <omgdi:waypoint x="384.95000000000005" y="187.0"></omgdi:waypoint>
                <omgdi:waypoint x="445.0" y="187.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_13828zo" id="BPMNEdge_Flow_13828zo" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="14.0" flowable:targetDockerY="14.0">
                <omgdi:waypoint x="1659.95" y="370.5"></omgdi:waypoint>
                <omgdi:waypoint x="1696.5" y="370.5"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0t98vlv" id="BPMNEdge_Flow_0t98vlv" flowable:sourceDockerX="15.0" flowable:sourceDockerY="15.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="869.9499979757518" y="190.0"></omgdi:waypoint>
                <omgdi:waypoint x="900.0" y="190.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0vkdg8s" id="BPMNEdge_Flow_0vkdg8s" flowable:sourceDockerX="20.0" flowable:sourceDockerY="20.0" flowable:targetDockerX="14.0" flowable:targetDockerY="14.0">
                <omgdi:waypoint x="1284.935564399421" y="190.0"></omgdi:waypoint>
                <omgdi:waypoint x="1320.0" y="190.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="sid-58FAF948-EC3F-4DE9-8C9C-5CAD2F6426A3" id="BPMNEdge_sid-58FAF948-EC3F-4DE9-8C9C-5CAD2F6426A3" flowable:sourceDockerX="15.5" flowable:sourceDockerY="15.5" flowable:targetDockerX="283.0" flowable:targetDockerY="151.0">
                <omgdi:waypoint x="735.7918996901299" y="189.21684813553776"></omgdi:waypoint>
                <omgdi:waypoint x="810.0" y="199.97449664429533"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow-subprocess-checkFinalState" id="BPMNEdge_flow-subprocess-checkFinalState" flowable:sourceDockerX="565.0" flowable:sourceDockerY="151.0" flowable:targetDockerX="1.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="1375.9499999999991" y="240.96774193548384"></omgdi:waypoint>
                <omgdi:waypoint x="1560.0" y="235.03064516129032"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_130f8tf" id="BPMNEdge_Flow_130f8tf" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="20.0" flowable:targetDockerY="20.0">
                <omgdi:waypoint x="1209.95" y="190.0"></omgdi:waypoint>
                <omgdi:waypoint x="1245.0" y="190.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_030lv4j" id="BPMNEdge_Flow_030lv4j" flowable:sourceDockerX="20.0" flowable:sourceDockerY="20.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="484.9420263788604" y="187.0"></omgdi:waypoint>
                <omgdi:waypoint x="539.9999999999578" y="187.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="sid-3C9C7EA0-4129-4176-BB90-004CDCA55E6C" id="BPMNEdge_sid-3C9C7EA0-4129-4176-BB90-004CDCA55E6C" flowable:sourceDockerX="20.0" flowable:sourceDockerY="20.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="465.0" y="206.9434846505552"></omgdi:waypoint>
                <omgdi:waypoint x="465.0" y="300.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0fi4bip" id="BPMNEdge_Flow_0fi4bip" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="20.0" flowable:targetDockerY="20.0">
                <omgdi:waypoint x="1209.95" y="295.0"></omgdi:waypoint>
                <omgdi:waypoint x="1265.0" y="295.0"></omgdi:waypoint>
                <omgdi:waypoint x="1265.0" y="209.90946139180176"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_04vgcgq" id="BPMNEdge_Flow_04vgcgq" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="14.0" flowable:targetDockerY="14.0">
                <omgdi:waypoint x="514.95" y="340.0"></omgdi:waypoint>
                <omgdi:waypoint x="576.0" y="340.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_1hv6ani" id="BPMNEdge_Flow_1hv6ani" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="335.0" y="303.0"></omgdi:waypoint>
                <omgdi:waypoint x="335.0" y="226.95000000000002"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="sid-B59A5914-F7DB-4A2C-B74A-C03D9E01B86A" id="BPMNEdge_sid-B59A5914-F7DB-4A2C-B74A-C03D9E01B86A" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="1610.0" y="274.95000000000005"></omgdi:waypoint>
                <omgdi:waypoint x="1610.0" y="330.5"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0x3s1eq" id="BPMNEdge_Flow_0x3s1eq" flowable:sourceDockerX="50.0" flowable:sourceDockerY="40.0" flowable:targetDockerX="20.0" flowable:targetDockerY="20.0">
                <omgdi:waypoint x="999.9499999999995" y="187.61904761904762"></omgdi:waypoint>
                <omgdi:waypoint x="1035.909090909091" y="185.9068181818182"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="Flow_0mp29qt" id="BPMNEdge_Flow_0mp29qt" flowable:sourceDockerX="15.0" flowable:sourceDockerY="15.0" flowable:targetDockerX="50.0" flowable:targetDockerY="40.0">
                <omgdi:waypoint x="224.9499988304931" y="343.0"></omgdi:waypoint>
                <omgdi:waypoint x="285.0" y="343.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</definitions>